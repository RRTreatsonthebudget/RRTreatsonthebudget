<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RR Treats Order Management</title>
  <style>
    /* Add your CSS here */
    body { font-family: Arial, sans-serif; }
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); }
    .modal-content { background-color: white; margin: 10% auto; padding: 20px; width: 80%; }
    .close { float: right; cursor: pointer; }
    .status-badge { padding: 4px 8px; border-radius: 4px; color: #fff; }
    .status-new { background-color: gray; }
    .status-processing { background-color: orange; }
    .status-completed { background-color: green; }
    .status-cancelled { background-color: red; }
  </style>
</head>
<body>
  <h1>RR Treats Orders</h1>

  <input type="text" id="orderSearch" placeholder="Search orders..." onkeyup="filterOrders()">
  <select id="statusFilter" onchange="filterOrders()">
    <option value="">All Statuses</option>
    <option value="new">New</option>
    <option value="processing">Processing</option>
    <option value="completed">Completed</option>
    <option value="cancelled">Cancelled</option>
  </select>

  <table id="ordersTable" border="1">
    <thead>
      <tr>
        <th>ID</th>
        <th>Date</th>
        <th>Name</th>
        <th>Product</th>
        <th>Qty</th>
        <th>Total</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="ordersTableBody"></tbody>
  </table>
  <div id="ordersPagination"></div>

  <!-- Order Modal (if needed) -->
  <div id="orderModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeOrderForm()">&times;</span>
      <form id="orderForm">
        <!-- Inputs for name, product, quantity, etc. -->
        <button type="submit">Submit Order</button>
      </form>
    </div>
  </div>

  <script>
    let orders = JSON.parse(localStorage.getItem('rrTreatsOrders')) || [];
    let productPrice = 100; // Default product price

    function closeOrderForm() {
      document.getElementById('orderModal').style.display = 'none';
    }

    function generateOrderId() {
      return 'RR' + Date.now().toString().slice(-6) + Math.floor(Math.random() * 1000);
    }

    function formatDate(date) {
      const d = new Date(date);
      return d.toLocaleDateString('en-PH', {
        year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit'
      });
    }

    document.getElementById('orderForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const quantity = parseInt(document.getElementById('quantity').value);
      const total = (productPrice * quantity);

      const newOrder = {
        id: generateOrderId(),
        date: new Date().toISOString(),
        product: document.getElementById('product').value,
        quantity: quantity,
        price: productPrice,
        total: total,
        name: document.getElementById('name').value,
        phone: document.getElementById('phone').value,
        address: document.getElementById('address').value,
        reference: document.getElementById('reference').value,
        status: 'new'
      };

      orders.unshift(newOrder);
      localStorage.setItem('rrTreatsOrders', JSON.stringify(orders));
      alert(`Thank you for your order! Your order ID is ${newOrder.id}`);
      this.reset();
      closeOrderForm();
      loadOrders();
    });

    function loadOrders() {
      const tableBody = document.getElementById('ordersTableBody');
      tableBody.innerHTML = '';

      if (orders.length === 0) {
        tableBody.innerHTML = '<tr><td colspan="8" style="text-align: center;">No orders found</td></tr>';
        return;
      }

      orders.forEach(order => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${order.id}</td>
          <td>${formatDate(order.date)}</td>
          <td>${order.name}</td>
          <td>${order.product}</td>
          <td>${order.quantity}</td>
          <td>${order.total.toFixed(2)}</td>
          <td><span class="status-badge status-${order.status}">${order.status.charAt(0).toUpperCase() + order.status.slice(1)}</span></td>
          <td>
            <button onclick="viewOrderDetails('${order.id}')">View</button>
            <button onclick="updateOrderStatus('${order.id}')">Update</button>
          </td>
        `;
        tableBody.appendChild(row);
      });
    }

    function updateOrderStatus(orderId) {
      viewOrderDetails(orderId);
      document.getElementById(`status-${orderId}`).focus();
    }

    function saveStatus(orderId) {
      const newStatus = document.getElementById(`status-${orderId}`).value;
      const index = orders.findIndex(order => order.id === orderId);
      if (index !== -1) {
        orders[index].status = newStatus;
        localStorage.setItem('rrTreatsOrders', JSON.stringify(orders));
        loadOrders();
        alert(`Order ${orderId} status updated to ${newStatus}`);
      }
    }

    function filterOrders() {
      const searchTerm = document.getElementById('orderSearch').value.toLowerCase();
      const statusFilter = document.getElementById('statusFilter').value;
      const rows = document.querySelectorAll('#ordersTableBody tr');

      rows.forEach(row => {
        const rowText = row.textContent.toLowerCase();
        const matchesSearch = rowText.includes(searchTerm);
        const matchesStatus = !statusFilter || rowText.includes(statusFilter);
        row.style.display = matchesSearch && matchesStatus ? '' : 'none';
      });
    }

    loadOrders();
  </script>
</body>
</html>
